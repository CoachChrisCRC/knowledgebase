<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gymini AI Knowledge Hub</title>
    <!-- Load Tailwind CSS CDN --><script src="https://cdn.tailwindcss.com"></script>
    <!-- Load React, ReactDOM, and Babel for JSX compilation --><script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Load Font Awesome (CDN - More reliable for single-file deployment) --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLMDJz9TTB8bH71X/xZ8Wf1F0x5G8R2Y5L5rE/6t6iFwP1u6t5tG3/H9k0Z1p8Q==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'black-accent': '#000000',
                    }
                }
            }
        }
    </script>
    
</head>
<body class="bg-gray-50 font-sans antialiased">

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // --- ICON UTILITY (Using Font Awesome Classes) ---
    const Icon = ({ name, className }) => {
        // Map abstract icon names to Font Awesome classes
        const iconClasses = {
            BookOpen: 'fa-solid fa-book-open',
            Brain: 'fa-solid fa-brain',
            Apple: 'fa-solid fa-apple-whole',
            Dumbbell: 'fa-solid fa-dumbbell',
            Zap: 'fa-solid fa-bolt',
            ChevronDown: 'fa-solid fa-chevron-down',
            List: 'fa-solid fa-list',
            X: 'fa-solid fa-xmark',
            Send: 'fa-solid fa-paper-plane',
            Loader: 'fa-solid fa-spinner',
        };
        const iconClass = iconClasses[name] || 'fa-solid fa-circle-question';

        return <i className={`${iconClass} ${className} flex-shrink-0`} aria-hidden="true" />;
    };


    // --- MARKDOWN RENDERING UTILITY ---
    const renderMarkdown = (text) => {
        if (!text) return null;
        const lines = text.split('\n');
        
        // 1. Inline bolding utility (local to this function)
        const renderBolding = (t) => {
            const parts = t.split(/(\*\*.*?\*\*)/g);
            return parts.map((part, index) => {
                if (part.startsWith('**') && part.endsWith('**')) {
                    const boldText = part.slice(2, -2);
                    return <strong key={index} className="font-bold text-gray-900">{boldText}</strong>;
                }
                return part;
            });
        };

        // 2. Block-level parsing
        return lines.map((line, index) => {
            const trimmedLine = line.trim();
            if (!trimmedLine) return null;

            // Headings (###)
            if (trimmedLine.startsWith('###')) {
                const content = trimmedLine.replace(/^#+\s*/, '');
                return (
                    <h3 key={index} className="text-lg font-extrabold text-gray-900 mt-4 mb-1">
                        {renderBolding(content)}
                    </h3>
                );
            }

            // List Items (*)
            if (trimmedLine.startsWith('* ')) {
                const content = trimmedLine.substring(2);
                return (
                    <div key={index} className="flex items-start text-gray-700 text-sm mt-1 pl-1">
                        <span className="text-gray-900 mr-2 mt-1">•</span>
                        <p className="flex-1">{renderBolding(content)}</p>
                    </div>
                );
            }
            
            // Paragraph (P) - Default behavior
            return (
                <p key={index} className="text-gray-700 leading-relaxed mt-2 text-sm">
                    {renderBolding(trimmedLine)}
                </p>
            );
        }).filter(Boolean);
    };


    // --- CORE KNOWLEDGE DATA (NOW FULLY RESTORED) ---
    const ACCENT_COLOR = 'text-black';
    const ACCENT_CLASS = 'bg-black hover:bg-gray-800';

    const knowledgeSections = [
        {
            id: 'home',
            title: 'Home / Performance Overview',
            icon: 'BookOpen',
            color: ACCENT_COLOR,
            content: null,
        },
        {
            id: 'ai-brain',
            title: 'Gymini: AI Coaching Brain',
            icon: 'Brain',
            color: ACCENT_COLOR,
            content: null,
        },
        {
            id: 'nutrition',
            title: 'Nutrition & Fueling',
            icon: 'Apple',
            color: 'text-gray-700',
            content: [
                {
                    title: 'Calorie Balance: The Simple Math of Weight Change',
                    body: 'Whether you gain, lose, or maintain weight comes down to one fundamental principle: **Energy Balance** (Calories In vs. Calories Out). Everything else is secondary.\n\nThe "Calories Out" side is called your **Total Daily Energy Expenditure (TDEE)**. It’s the total energy your body burns every day, which is made up of four main factors:\n\n* **Resting Metabolism (BMR):** Energy used for basic survival (breathing, circulating blood). This is the biggest factor.\n* **Digesting Food (TEF):** Energy used to process the food you eat. **Protein requires the most energy to digest,** which is one reason it’s great for weight loss.\n* **Daily Movement (NEAT):** Energy from non-exercise activity like walking, standing, and fidgeting. This is highly variable and often the biggest difference between two people\'s daily burn.\n* **Workouts (EAT):** Calories burned during structured exercise.\n\nTo achieve **Fat Loss**, you need a consistent **Calorie Deficit** (eating slightly fewer calories than your TDEE). To achieve **Muscle Gain**, you need a small **Calorie Surplus** (eating slightly more than your TDEE). '
                },
                {
                    title: 'Protein: The Most Important Macro',
                    body: 'Protein is the most crucial macronutrient for anyone trying to build muscle, lose fat, or improve body composition. It provides the **building blocks (amino acids)** necessary to repair and grow muscle tissue after training.\n\n**Key Facts:**\n\n* **Satiety:** Protein is highly satiating, meaning it helps you feel full, which is vital for managing calorie intake.\n* **Thermic Effect (TEF):** Protein has a higher thermic effect than carbs or fat, meaning your body burns more calories just to digest it.\n* **Goal Intake:** Aim for **0.8g to 1.2g of protein per pound of desired body weight** (or 1.8g to 2.6g per kg of body weight). \n\n**Practical Sources:** Chicken breast, lean beef, fish (tuna, salmon), eggs, Greek yogurt, cottage cheese, and protein powders (whey or plant-based).'
                },
                {
                    title: 'Carbohydrates and Fats: Energy and Hormones',
                    body: 'Carbs and fats are essential for energy, brain function, and hormone regulation. They are often needlessly feared.\n\n### Carbohydrates (The Engine Fuel)\n\n* **Role:** Primary energy source for high-intensity training and brain function. Replenishes muscle **glycogen** stores.\n* **Types:** **Complex Carbs** (oats, brown rice, whole grains) provide sustained energy and fiber. **Simple Carbs** (fruit, refined sugar) provide quick energy.\n* **Timing:** Consume most carbs around your workouts (pre- and post-workout) to maximize performance and recovery.\n\n### Dietary Fats (The Regulator)\n\n* **Role:** Crucial for hormone production (like testosterone), brain health, nutrient absorption (Vitamins A, D, E, K), and insulating organs.\n* **Types:** Focus on **Unsaturated Fats** (avocados, nuts, olive oil, fatty fish) and limit Saturated/Trans Fats.\n* **Caution:** Fat is calorie-dense (9 calories per gram vs. 4 for protein/carbs), so track portions carefully, especially when in a calorie deficit.'
                },
            ]
        },
        {
            id: 'training',
            title: 'Training Principles',
            icon: 'Dumbbell',
            color: ACCENT_COLOR,
            content: [
                {
                    title: 'Progressive Overload: Challenging Yourself Just a Little More',
                    body: 'The only way your body changes is if you constantly give it a reason to. **Progressive Overload** simply means finding a way to make your workouts slightly harder over time. If you do the exact same workout with the exact same weight every week, your body has no incentive to build muscle or get stronger.\n\nStrive to apply at least one of these challenges to your main exercises *each week*:\n\n* **Lift Heavier (Load):** Add a small amount of weight (like 2.5 lbs or 1kg) to your barbell or machine. This is one of the fastest ways to get stronger and build density.\n* **Do More Reps (Volume):** Complete one or two extra repetitions on a set.\n* **Do More Sets (Volume):** Add one entire working set to an exercise.\n* **Rest Less (Density):** Complete the same workout but actively cut your rest periods by 15-30 seconds. This improves your overall work capacity.\n* **Slow Down (Time Under Tension):** Deliberately take 3-4 seconds to lower the weight (the eccentric phase). This makes the muscle work harder and feel the tension.'
                },
                {
                    title: 'Rep Ranges and Intensity (RIR)',
                    body: 'The number of repetitions (reps) you choose is directly linked to the desired training outcome.\n\n### Rep Ranges\n\n* **Strength (1-5 Reps):** Builds maximum strength by emphasizing heavy loads and neural drive.\n* **Hypertrophy (6-15 Reps):** The ideal range for building muscle size (most common range in programs).\n* **Endurance (15+ Reps):** Builds muscular stamina and work capacity.\n\n### Intensity (RIR)\n\n**Reps In Reserve (RIR)** is a modern, effective way to gauge how hard you are truly pushing. RIR means how many more full repetitions you could have done before total failure.\n\n* **RIR 3-4 (Easy/Warm-up):** The weight felt light, you could have done 3-4 more reps.\n* **RIR 1-2 (Optimal Hypertrophy):** This is the sweet spot. The set felt difficult, and you could only do 1-2 more reps before your form broke down.\n* **RIR 0 (Failure):** You could not complete another rep. This should be used sparingly, primarily on final sets of accessory work.'
                },
                {
                    title: 'The Science of Recovery (Sleep)',
                    body: 'You don\'t build muscle *during* a workout; you build it *during recovery*. **Sleep is non-negotiable** for progress.\n\n* **Muscle Repair:** Growth hormone and testosterone peak during deep sleep, facilitating muscle protein synthesis and repair.\n* **Fat Loss:** Lack of sleep disrupts two key hormones:\n    * **Ghrelin (Hunger Hormone):** Increases when sleep-deprived, making you feel hungrier.\n    * **Leptin (Satiety Hormone):** Decreases when sleep-deprived, meaning you feel less full.\n* **Cognition:** Poor sleep severely impairs focus, motivation, and coordination, leading to worse workouts and a higher risk of injury.\n\n**Goal:** Aim for **7-9 hours** of quality sleep per night. Implement a "power-down" routine (no screens 30-60 minutes before bed) to improve sleep quality.'
                },
            ]
        },
        {
            id: 'mindset',
            title: 'Habits & Mindset',
            icon: 'Zap',
            color: 'text-gray-700',
            content: [
                {
                    title: 'SMART Goals: Making Your Wishes Actionable',
                    body: 'Wishing for a goal is not enough—you need a clear roadmap. Goals must be **SMART** to provide clarity and keep you on track:\n\n* **S**pecific: "Lose 10 lbs" vs. "Feel better."\n* **M**easurable: Track progress with numbers (weight, reps, body measurements).\n* **A**chievable: Challenging but realistic for your current life.\n* **R**elevant: Aligns with your deep reasons for wanting to change.\n* **T**ime-bound: Set a specific deadline.\n\n**Focus on the Daily Process:** While the outcome (e.g., "Lose 20 lbs") is the destination, your daily focus should be on the **process** (e.g., "Hit my protein goal today," or "Get my 8,000 steps in"). You control the process; the outcome is the reward for following it.'
                },
                {
                    title: 'The Plateaus and Setbacks',
                    body: 'Progress is not a straight line—it’s an uneven road with plateaus (stalling progress) and setbacks (injuries, missed workouts, holidays).\n\n### The Plateau Solution\n\nIf your progress stalls for two weeks or more, try one of these strategies:\n\n* **Deload:** Take a scheduled week of light training (50% of your normal weight/volume). This helps your body recover from accumulated fatigue. You\'ll often come back stronger.\n* **Change Rep Ranges:** Switch from hypertrophy (8-12 reps) to strength (4-6 reps) for a few weeks to introduce a new stimulus.\n* **Check Compliance:** Honestly review your diet and sleep. Plateaus are almost always caused by an overlooked calorie creep or poor recovery.\n\n### Handling Setbacks\n\nDon\'t let a temporary failure (a missed day, a holiday) derail your entire journey. Get back to your routine immediately. One bad day doesn\'t erase weeks of consistency.'
                },
                {
                    title: 'Habit Stacking and Environment Design',
                    body: 'The key to long-term success is making good habits **easy** and bad habits **difficult**.\n\n* **Habit Stacking:** Attach a new habit to an existing one. **Example:** *“After I pour my morning coffee (existing habit), I will drink a large glass of water (new habit).”*\n* **Environment Design:** Set up your surroundings for success.\n    * **Goal:** Eating more fruit? **Action:** Leave a bowl of apples right next to your keys.\n    * **Goal:** Hitting the gym? **Action:** Lay out your gym clothes the night before, and pack your bag right after dinner.\n\nThis removes the need for motivation, which is unreliable. You rely on friction-less systems instead.'
                }
            ]
        },
    ];
    // --- END CORE KNOWLEDGE DATA ---

    // --- UTILITY COMPONENTS (Accordion and HomeContent remain the same) ---
    const AccordionItem = ({ item, isActive, toggleActive }) => (
        <div className="border-b border-gray-300">
            <button
                className="flex justify-between items-center w-full p-4 text-left font-semibold text-gray-800 hover:bg-gray-100 transition-colors"
                onClick={toggleActive}
                aria-expanded={isActive}
                aria-controls={`content-${item.title.replace(/\s/g, '-')}`}
            >
                <span>{item.title}</span>
                <Icon name="ChevronDown" className={`w-4 h-4 transition-transform ${isActive ? 'transform rotate-180' : ''}`} />
            </button>
            <div
                id={`content-${item.title.replace(/\s/g, '-')}`}
                className={`overflow-hidden transition-all duration-300 ease-in-out ${isActive ? 'max-h-[2200px] opacity-100 p-4 pt-0' : 'max-h-0 opacity-0 p-0'}`}
            >
                <div className="text-sm font-sans bg-gray-50 p-3 rounded-lg border border-gray-200 space-y-1">
                    {renderMarkdown(item.body ? item.body.trim() : 'Content loading error or missing.')}
                </div>
            </div>
        </div>
    );

    const HomeContent = ({ color, sections, onNavigate }) => (
        <div className="space-y-8 p-6 bg-white rounded-xl shadow-lg border-t-8 border-black min-h-[600px] flex flex-col justify-center">
            <header className="text-center">
                <div className="flex items-center justify-center space-x-3 mb-4">
                    {/* UPDATED: Larger icons here */}
                    <Icon name="BookOpen" className={`w-16 h-16 ${color}`} />
                    <Icon name="Brain" className={`w-16 h-16 ${color}`} />
                </div>
                <h2 className="text-4xl sm:text-5xl font-extrabold text-gray-900 tracking-tight">
                    CLIENT KNOWLEDGE BASE
                </h2>
                <p className={`text-xl font-bold tracking-widest mt-1 text-black/80`}>
                    #FITTER #STRONGER #BETTER
                </p>
            </header>

            <div className="prose max-w-none text-gray-600 space-y-6">
                <p className="text-xl leading-relaxed text-center font-medium">
                    This is your definitive reference for all the <strong className="font-bold text-gray-900">science-backed strategies</strong> needed to support your training & nutrition, broaden your knowledge, optimize recovery, and make meaningful change to help you achieve your fitness goals.
                </p>

                <h3 className="text-2xl font-bold text-gray-800 border-b pb-2">Master the Fundamentals:</h3>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {sections.filter(s => s.id !== 'ai-brain').map((section) => (
                    <button
                        key={section.id}
                        onClick={() => onNavigate(section.id)}
                        className={`p-4 rounded-lg shadow-sm border text-left transition-transform duration-200 hover:scale-[1.01] hover:shadow-lg focus:ring-2 focus:ring-black block w-full h-full bg-gray-50 border-gray-200`}
                    >
                        <Icon name={section.icon} className={`w-6 h-6 inline mr-3 ${ACCENT_COLOR}`} />
                        <strong className={`${ACCENT_COLOR}`}>{section.title}:</strong>
                        <p className="mt-1 text-sm text-gray-600">
                            {section.id === 'nutrition' && 'Master Calorie Balance, Macro breakdowns, Hydration, and practical strategies for meal prep and eating out.'}
                            {section.id === 'training' && 'The core of growth, covering Progressive Overload, Rep Ranges, proper Form & Technique, Recovery Science (Sleep), and how to periodize your workouts.'}
                            {section.id === 'mindset' && 'Build resilience with SMART Goal Setting, learn to deal with plateaus, design your environment for success, and overcome social pressure.'}
                        </p>
                    </button>
                ))}
                
                <button
                    onClick={() => onNavigate('ai-brain')}
                    className={`p-4 rounded-lg shadow-sm border text-left transition-transform duration-200 hover:scale-[1.01] hover:shadow-lg focus:ring-2 focus:ring-black block w-full h-full bg-black/5 border-black/10`}
                >
                    <Icon name={'Brain'} className={`w-6 h-6 inline mr-3 text-black`} />
                    <strong className={`text-black`}>Gymini: AI Coaching Brain:</strong>
                    <p className="mt-1 text-sm text-gray-600">
                        Ask any general fitness question and get immediate, grounded, and evidence-based answers in real-time.
                    </p>
                </button>
                </div>

                <footer className="mt-8 pt-4 border-t border-gray-200 text-center">
                    <p className="text-sm italic text-gray-500">
                        This resource complements your personalized training plan. <strong className="font-bold text-gray-600">Select a category from the sidebar or above to learn more.</strong>
                    </p>
                </footer>
            </div>
        </div>
    );
    // --- END UTILITY COMPONENTS ---


    // --- AI BRAIN COMPONENT ---
    const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));

    const AICoach = () => {
        const [query, setQuery] = useState('');
        const [response, setResponse] = useState(null);
        const [isLoading, setIsLoading] = useState(false);
        const [error, setError] = useState(null);
        const [expandedCategories, setExpandedCategories] = useState({
            "Nutrition & Fueling": false,
            "Training Principles": false,
            "Habits & Mindset": false,
        });

        const formRef = useRef(null); 

        // CRITICAL: API URL points to the Netlify Function Proxy
        const apiUrl = '/.netlify/functions/gemini_proxy'; 

        const nutritionQueries = ["How much protein do I actually need to build muscle?", "Explain the difference between simple and complex carbs.", "What are the benefits of taking creatine?", "What are good sources of healthy dietary fats?"];
        const trainingQueries = ["Explain progressive overload and give examples.", "What are the best mobility drills for squats?", "What is the RIR (Reps in Reserve) rule?", "Should I do HIIT or LISS cardio for fat loss?"];
        const mindsetQueries = ["How does stress (cortisol) affect my fat loss efforts?", "Give me an example of habit stacking for my morning routine.", "How can I set SMART goals for my fitness journey?", "What are non-scale victories (NSVs)?"];
        const categorizedQueries = [
            { title: "Nutrition & Fueling", queries: nutritionQueries },
            { title: "Training Principles", queries: trainingQueries },
            { title: "Habits & Mindset", queries: mindsetQueries },
        ];

        const handleSubmit = async (e) => {
            if (e && e.preventDefault) { e.preventDefault(); }
            
            const queryToSubmit = query.trim() || (e?.target?.query?.value || '').trim();

            if (!queryToSubmit || isLoading) return;

            setResponse(null);
            setError(null);
            setIsLoading(true);

            // Clear input after capturing the query
            setQuery(''); 

            try {
                let result = null;
                let attempt = 0;
                const maxRetries = 5;

                while (attempt < maxRetries) {
                    try {
                        // Send the prompt to the Netlify Proxy
                        const apiResponse = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            // The proxy expects the user's prompt in the body
                            body: JSON.stringify({ prompt: queryToSubmit }) 
                        });

                        if (apiResponse.status === 401) {
                            throw new Error("Proxy Error: The Gemini API Key is missing or invalid in Netlify Environment Variables.");
                        }

                        if (!apiResponse.ok) {
                            throw new Error(`Proxy Error: Failed to fetch AI response. Status: ${apiResponse.status}`);
                        }

                        result = await apiResponse.json();
                        break;

                    } catch (err) {
                        attempt++;
                        if (attempt >= maxRetries) {
                            console.error("Max retries reached. Failed to fetch AI response.", err);
                            throw new Error("The AI Brain is currently unavailable. Please check the Netlify function logs.");
                        }
                        const delay = Math.pow(2, attempt) * 1000;
                        await sleep(delay);
                    }
                }

                // The response structure from the proxy is simpler, containing only text and sources
                const text = result?.text || "Sorry, I couldn't generate a helpful response right now. Please try rephrasing your question.";
                const sources = result?.sources || [];
                
                setResponse({ text, sources });

            } catch (err) {
                setError(err.message);
            } finally {
                setIsLoading(false);
            }
        };

        const handleSuggestionClick = (suggestion) => {
            setQuery(suggestion);
            setTimeout(() => {
                if (formRef.current) {
                    // Manually trigger the submit event via the form ref
                    handleSubmit({ preventDefault: () => {} }); 
                }
            }, 0);
        };
        
        const toggleCategory = (title) => {
            setExpandedCategories(prev => ({
                ...prev,
                [title]: !prev[title]
            }));
        };

        // UI rendering logic remains the same...
        return (
            <div className="flex flex-col h-full min-h-[600px]">
                <div className="mb-6">
                    <h2 className="text-3xl sm:text-4xl font-extrabold text-gray-900 flex items-center">
                        <Icon name="Brain" className={`w-8 h-8 mr-3 ${ACCENT_COLOR}`} />
                        Gymini: AI Coaching Brain
                    </h2>
                    <p className="mt-2 text-gray-500 text-lg border-l-4 border-black pl-4 py-2 bg-gray-50/50 rounded-lg">
                        Tap into a vast knowledge base. Ask general questions on nutrition, training, and technique. <strong className="font-bold text-gray-900">For specific, tailored advice on your program, please message your actual coach.</strong>
                    </p>
                </div>

                <div className="flex-grow bg-white p-4 rounded-xl shadow-inner mb-6 border border-gray-200">
                    {isLoading && (
                        <div className="text-center p-8 text-black">
                            <Icon name="Loader" className="w-8 h-8 mx-auto animate-spin" />
                            <p className="mt-2">Thinking... Accessing the fitness knowledge base.</p>
                        </div>
                    )}

                    {error && (
                        <div className="bg-red-100 border border-red-500 text-red-700 px-4 py-3 rounded-lg relative">
                            <p className="font-bold">Error:</p>
                            <p className="text-sm">{error}</p>
                        </div>
                    )}

                    {response ? (
                        <div className="space-y-4">
                            <h3 className="font-bold text-lg text-gray-800">Gymini Response:</h3>
                            <div className="text-gray-700">
                                {renderMarkdown(response.text)}
                            </div>
                            
                            {response.sources.length > 0 && (
                                <div className="mt-4 pt-3 border-t border-gray-200 text-xs text-gray-500">
                                    <p className="font-semibold">Sources:</p>
                                    <ul className="list-disc ml-4 space-y-1 mt-1">
                                        {response.sources.slice(0, 3).map((source, index) => (
                                            <li key={index} className="truncate">
                                                <a href={source.uri} target="_blank" rel="noopener noreferrer" className="text-black hover:underline">{source.title}</a>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                            )}
                            
                            <div className="mt-6 p-3 bg-gray-100 border-l-4 border-black rounded-lg text-sm text-gray-800 font-medium shadow-sm">
                                <strong className="font-bold text-gray-900">IMPORTANT:</strong> This advice is general knowledge. For personalized programming, check-ins, or questions specific to your training history and medical status, <strong className="font-bold text-gray-900">please message your actual Personal Trainer!</strong>
                            </div>
                        </div>
                    ) : !isLoading && (
                        <div className="text-center p-8 text-gray-400">
                            <Icon name="Brain" className="w-10 h-10 mx-auto mb-3" />
                            <p>Ask a general question about fitness, nutrition, or motivation.</p>
                        </div>
                    )}
                </div>

                <div className="mb-4">
                    <p className="text-sm font-semibold text-gray-700 mb-2">Popular Searches (Click to Ask):</p>
                    <div className="space-y-2 border border-gray-300 rounded-xl overflow-hidden shadow-md">
                        {categorizedQueries.map((category) => {
                            const isExpanded = expandedCategories[category.title];
                            return (
                                <div key={category.title} className="border-b border-gray-200 last:border-b-0">
                                    <button
                                        className="flex justify-between items-center w-full p-3 text-left font-bold text-sm text-gray-800 bg-gray-50 hover:bg-gray-100 transition-colors"
                                        onClick={() => toggleCategory(category.title)}
                                        aria-expanded={isExpanded}
                                    >
                                        <span>{category.title}</span>
                                        <Icon name="ChevronDown" className={`w-4 h-4 transition-transform ${isExpanded ? 'transform rotate-180' : ''}`} />
                                    </button>
                                    
                                    <div 
                                        className={`overflow-hidden transition-all duration-300 ease-in-out ${isExpanded ? 'max-h-[300px] opacity-100 p-3 pt-1' : 'max-h-0 opacity-0 p-0'}`}
                                    >
                                        <div className="flex flex-wrap gap-2">
                                            {category.queries.map((s, index) => (
                                                <button
                                                    key={index}
                                                    onClick={() => handleSuggestionClick(s)}
                                                    className={`text-xs px-3 py-1.5 rounded-full border border-gray-300 text-gray-600 bg-white hover:bg-gray-100 transition-colors shadow-sm
                                                        ${isLoading ? 'opacity-60 cursor-not-allowed' : ''}
                                                    `}
                                                    disabled={isLoading}
                                                >
                                                    {s}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>

                <form ref={formRef} onSubmit={handleSubmit} className="flex space-x-3">
                    <input
                        type="text"
                        value={query}
                        onChange={(e) => setQuery(e.target.value)}
                        placeholder="e.g., 'What is progressive overload?' or 'Best source of complex carbs?'"
                        className="flex-grow p-3 border border-gray-400 rounded-xl focus:ring-2 focus:ring-black focus:border-black transition shadow-sm"
                        disabled={isLoading}
                        name="query"
                    />
                    <button
                        type="submit"
                        className={`p-3 rounded-xl text-white transition duration-200 shadow-md ${isLoading ? 'bg-gray-500' : 'bg-black hover:bg-gray-800'}`}
                        disabled={isLoading}
                    >
                        <Icon name="Send" className="w-6 h-6" />
                    </button>
                </form>
            </div>
        );
    };

    // --- MAIN APP COMPONENT ---
    const App = () => {
        const [activeSectionId, setActiveSectionId] = useState(knowledgeSections[0].id);
        const [activeAccordion, setActiveAccordion] = useState(null);
        const [isMenuOpen, setIsMenuOpen] = useState(false);

        const activeSection = knowledgeSections.find(s => s.id === activeSectionId);
        const cardSections = knowledgeSections.filter(s => s.id !== 'home' && s.id !== 'recipes');

        const currentYear = new Date().getFullYear();

        const toggleAccordion = (title) => {
            setActiveAccordion(activeAccordion === title ? null : title);
        };

        const handleSectionClick = (id) => {
            setActiveSectionId(id);
            setIsMenuOpen(false);
            setActiveAccordion(null);
        };

        const renderContent = () => {
            if (!activeSection) { return null; }

            if (activeSectionId === 'home') {
                return <HomeContent color={activeSection.color} sections={cardSections} onNavigate={handleSectionClick} />;
            }
            
            if (activeSectionId === 'ai-brain') {
                return <AICoach />;
            }
            
            if (activeSection.content) {
                return (
                    <section>
                        <div className="flex items-center mb-6">
                            <Icon name={activeSection.icon} className={`w-8 h-8 mr-3 ${activeSection.color}`} />
                            <h2 className="text-3xl sm:text-4xl font-extrabold text-gray-900">{activeSection.title}</h2>
                        </div>
                        <p className="mb-8 text-gray-500 text-lg border-l-4 border-black pl-4 py-2 bg-gray-50/50 rounded-lg">
                            This section contains the fundamental knowledge required for success. Review these topics regularly to build a strong foundation for your performance and fitness journey.
                        </p>
                        <div className="space-y-0 border border-gray-300 rounded-xl overflow-hidden shadow-lg">
                            {activeSection.content.map((item, index) => (
                                <AccordionItem
                                    key={index}
                                    item={item}
                                    isActive={activeAccordion === item.title}
                                    toggleActive={() => toggleAccordion(item.title)}
                                />
                            ))}
                        </div>
                    </section>
                );
            }
            return null;
        };

        return (
            <div className="min-h-screen bg-gray-50 font-sans antialiased">
                <div className="max-w-7xl mx-auto flex flex-col lg:flex-row shadow-xl bg-white rounded-xl my-4 sm:my-8 overflow-hidden">
                    
                    {/* Sidebar */}
                    <div className="lg:w-1/4 bg-black text-white p-6 shadow-2xl">
                        <header className="mb-8 flex justify-between items-center lg:block">
                            <button
                                onClick={() => handleSectionClick('home')}
                                className="transition duration-300 text-left w-full"
                            >
                                <div className="font-black text-white tracking-wider leading-none">
                                    <div className="text-2xl sm:text-3xl tracking-widest">COACH CHRIS</div>
                                    <div className="text-xs tracking-tight text-white/80 mt-[-4px] leading-none">CIRCULAR ROOTS COACHING</div>
                                    <div className="text-[10px] tracking-tighter text-white/60 leading-none">TRAIN UNCNVNTNL</div>
                                </div>
                            </button>
                            
                            <button 
                                className="lg:hidden p-2 rounded-lg text-gray-200 hover:bg-gray-800 transition"
                                onClick={() => setIsMenuOpen(!isMenuOpen)}
                                aria-label="Toggle navigation menu"
                            >
                                <Icon name={isMenuOpen ? "X" : "List"} className="w-6 h-6" />
                            </button>
                        </header>

                        <nav className={`${isMenuOpen ? 'block' : 'hidden'} lg:block`}>
                            <ul className="space-y-3">
                                {knowledgeSections.map((section) => (
                                    <li key={section.id}>
                                        <button
                                            onClick={() => handleSectionClick(section.id)}
                                            className={`flex items-center w-full p-3 rounded-lg text-left transition duration-200 group
                                                ${activeSectionId === section.id
                                                    ? `${ACCENT_CLASS} text-white shadow-lg font-bold`
                                                    : 'text-gray-300 hover:bg-gray-800 hover:text-white'
                                                }`}
                                        >
                                            <Icon name={section.icon} className={`w-5 h-5 mr-3 ${activeSectionId === section.id ? 'text-white' : 'text-gray-400'}`} />
                                            {section.title}
                                        </button>
                                    </li>
                                ))}
                            </ul>
                        </nav>
                    </div>

                    {/* Main Content Area */}
                    <main className="lg:w-3/4 p-6 sm:p-10">
                        <div className="min-h-[600px] flex flex-col">
                            {renderContent()}
                        </div>
                    </main>
                </div>

                {/* Footer */}
                <footer className="bg-black py-8 border-t border-white/10 w-full mt-8">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-white/50">
                        <p className="text-xs mb-4 max-w-3xl mx-auto leading-relaxed text-red-300/80">
                            <strong>General Fitness Disclaimer:</strong> Always consult with a qualified healthcare professional before starting any new fitness program or making changes to your diet. The content on this site and within our programs is for informational purposes only and is not a substitute for medical advice or diagnosis. You engage in physical activity at your own risk.
                        </p>
                        <p id="copyright-text" className="text-sm font-semibold mb-1 text-white">
                            &copy; {currentYear} COACH CHRIS | CIRCULAR ROOTS COACHING | TRAIN UNCNVNTNL. All rights reserved
                        </p>
                        <p className="text-xs text-white/60">Fitter Stronger Better</p>
                    </div>
                </footer>
            </div>
        );
    };

    // Render the App
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);

</script>
</body>
</html>

